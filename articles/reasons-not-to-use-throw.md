---
title: "ç§ãŒthrowã‚’ä½¿ã‚ãªã„ç†ç”±"
emoji: "ğŸ˜Š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['javascript','typescript']
published: false
---

## ç§ãŒthrowã‚’ä½¿ã‚ãªã„ç†ç”±

JavaScriptã§ã¯`throw`æ–‡ã¨ã„ã†æ–‡ã‚’ä½¿ã†ã“ã¨ã§ä¾‹å¤–ã‚’æŠ•ã’ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://jsprimer.net/basic/error-try-catch/#throw

https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/throw

ã“ã®`throw`æ–‡ã§ã™ãŒã€ç§ã¯ã‚ˆããƒ¬ãƒ“ãƒ¥ãƒ¼ãªã©ã§ä¾‹å¤–ã‚’æŠ•ã’ãªã„ã§ãã ã•ã„ï¼ˆ`throw`æ–‡ã‚’ä½¿ã‚ãªã„ã§ã»ã—ã„ï¼‰ã¨ã„ã†ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã™ã‚‹ã®ã§ã™ãŒ

### å‰ææ¡ä»¶

ã“ã®è¨˜äº‹ã®å†…å®¹ã¯ä¸‹è¨˜ã®æ¡ä»¶ã‚’å‰æã¨ã—ã¦æ›¸ãé€²ã‚ã¦ã„ãã¾ã™ã€‚

- `TypeScript`ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ã“ã¨
- Webãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã«`JavaScript`ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆ

Node.jsã‚’åˆ©ç”¨ã—ãŸã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã‚„CLIãƒ„ãƒ¼ãƒ«ã®é–‹ç™ºã€å„ç¨®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é–‹ç™ºã«ã¤ã„ã¦ã¯æœ¬è¨˜äº‹ã®å¯¾è±¡ã«å«ã¾ã‚Œãªã„ã“ã¨ã‚’ã”äº†æ‰¿ä¸‹ã•ã„ã€‚

### çµè«–

å…ˆã«çµè«–ã‹ã‚‰æ›¸ã„ã¦ãŠãã¨TypeScriptã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆä¾‹å¤–ã¯ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã™ã‚‹ã‹ã€Resultå‹ã‚’åˆ©ç”¨ã™ã‚‹ã®ãŒã‚ˆã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚
æ¬¡ã®ç« ã‹ã‚‰ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ç”¨ã„ãªãŒã‚‰`throw`æ–‡ã‚’ä½¿ã£ãŸå®Ÿä¾‹ã¨ã€ä»£æ›¿ãˆæ¡ˆã«ã¤ã„ã¦è¨˜è¿°ã—ã¦ã„ãã¾ã™ã€‚

### throwæ–‡ã®å•é¡Œç‚¹

`throw`æ–‡ã‚’åˆ©ç”¨ã—ãŸå ´åˆã®ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã¨ã—ã¦å€‹äººçš„ã«æ„Ÿã˜ã¦ã„ã‚‹è¦³ç‚¹ã¯ä¸‹è¨˜ã®ï¼’ã¤ã§ã™ã€‚

- `try...catch`ã‚’ä½¿ã†ã¹ãé–¢æ•°ãªã®ã‹ã¨ã„ã†æƒ…å ±ãŒå¤–éƒ¨ã‹ã‚‰åˆ†ã‹ã‚‰ãªã„
- æƒ³å®šã—ã¦ã„ãªã„`Error`ã‚’å—ã‘å–ã£ã¦ã—ã¾ã†å ´åˆãŒã‚ã‚‹

ä¸‹è¨˜ã®`x`ã¨`y`ã‚’å…¥åŠ›ã—ã¦ãã®åˆè¨ˆå€¤ã‚’è¿”ã™`add`é–¢æ•°ã‚’ä¾‹ã¨ã—ã¦è€ƒãˆã¦ã„ãã¾ã™ã€‚

```ts:sample.ts
export const add = (x: number, y: number): number => {
  return x + y;
}
```

ã“ã®é–¢æ•°ã«`x`ã‹`y`ã©ã¡ã‚‰ã‹ãŒ`NaN`ã®å ´åˆä¾‹å¤–ã‚’æŠ•ã’ã‚‹ã¨ã„ã†ä½¿ç”¨ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```diff ts:sample.ts
 export const add = (x: number, y: number): number => {
+  if (Number.isNaN(x) || Number.isNaN(y)) {
+    throw new Error('NaNã¯å…¥åŠ›å€¤ã¨ã—ã¦ä½¿ç”¨ã§ããªã„');
+  }
   return x + y;
 }
```

ã“ã‚Œã§ã“ã®é–¢æ•°ã¯ç‰¹å®šã®æ¡ä»¶ã§ä¾‹å¤–ã‚’æŠ•ã’ã‚‹é–¢æ•°ã¨ãªã‚Šã¾ã—ãŸã€‚

ã¾ãšã¯ã€Œ`try...catch`ã‚’ä½¿ã†ã¹ãé–¢æ•°ãªã®ã‹ã¨ã„ã†æƒ…å ±ãŒå¤–éƒ¨ã‹ã‚‰åˆ†ã‹ã‚‰ãªã„ã€ã¨ã„ã†éƒ¨åˆ†ã§ã™ãŒ  
ã“ã®é–¢æ•°ã‚’ä»–ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰`import`ã—ã¦åˆ©ç”¨ã™ã‚‹å ´åˆå‹å®šç¾©ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts:sample.d.ts
export declare const add: (x: number, y: number) => number;
```

ã“ã®çŠ¶æ…‹ã§ã¯å¤–éƒ¨ã‹ã‚‰åˆ©ç”¨ã™ã‚‹éš›ã«å¤±æ•—ã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹é–¢æ•°ï¼ˆ`try...catch`ã‚’åˆ©ç”¨ã™ã‚‹ã¹ãé–¢æ•°ï¼‰ã§ã‚ã‚‹ã“ã¨ãŒã‚³ãƒ¼ãƒ‰å†…éƒ¨ã‚’ç¢ºèªã™ã¾ã§åˆ†ã‹ã‚‰ãªã„çŠ¶æ…‹ã¨ãªã‚Šã¾ã™ã€‚

### Errorã¨ã®Unionå‹ã§è¡¨ç¾ã™ã‚‹

ä¸€ç•ªã¨ã£ã¤ãã‚„ã™ã„å¤‰æ›´ã¨ã—ã¦ã¯å¾“æ¥`throw new Error()`ã¨ã—ã¦ã„ãŸç®‡æ‰€ã‚’`return new Error()`ã«æ›¸ãæ›ãˆã‚‹æ‰‹æ³•ã ã¨æ€ã„ã¾ã™ã€‚
ã“ã‚Œã¾ã§ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã«é©ç”¨ã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```diff ts
-export const add = (x: number, y: number): number => {
+export const add = (x: number, y: number): number | Error => {
   if (Number.isNaN(x) || Number.isNaN(y)) {
-    throw new Error('NaNã¯å…¥åŠ›å€¤ã¨ã—ã¦ä½¿ç”¨ã§ããªã„');
+    return new Error('NaNã¯å…¥åŠ›å€¤ã¨ã—ã¦ä½¿ç”¨ã§ããªã„');
   }
   return x + y;
 }
```

å¤‰æ›´ã‚’åŠ ãˆã‚‹ã“ã¨ã«ã‚ˆã‚Šé–¢æ•°ã®è¿”ã‚Šå€¤ã®å‹ãŒ`number`ã‹ã‚‰`number|Error`ã«å¤‰åŒ–ã—ã¾ã—ãŸã€‚
ã“ã®ã‚ˆã†ã«ä¾‹å¤–ã‚’æŠ•ã’ã‚‹ã®ã§ã¯ãªãã€ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šåˆ©ç”¨å´ã§ã¯`Error`å‹ãŒå«ã¾ã‚Œã‚‹ãŸã‚å¤±æ•—ã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹é–¢æ•°ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

ã—ã‹ã—ã“ã®æ–¹æ³•ã§ã‚‚ã€Œæƒ³å®šã—ã¦ã„ãªã„`Error`ã‚’å—ã‘å–ã£ã¦ã—ã¾ã†å ´åˆãŒã‚ã‚‹ã€ã¨ã„ã†å•é¡Œã¯è§£æ±ºã—ã¾ã›ã‚“ã€‚

### æƒ³å®šã—ã¦ã„ãªã„`Error`ã‚’å—ã‘å–ã£ã¦ã—ã¾ã†å ´åˆãŒã‚ã‚‹

æ¬¡ã«ã€Œæƒ³å®šã—ã¦ã„ãªã„`Error`ã‚’å—ã‘å–ã£ã¦ã—ã¾ã†å ´åˆãŒã‚ã‚‹ã€ã¨ã„ã†å•é¡Œã§ã™ãŒã€ã¾ãšã¯æœ€åˆã®`throw`ã‚’ä½¿ã£ãŸå®Ÿè£…ã‹ã‚‰ç¢ºèªã—ã¦ã„ãã¾ã™ã€‚

```ts:sample.ts
export const add = (x: number, y: number): number => {
  if (Number.isNaN(x) || Number.isNaN(y)) {
    throw new Error('NaNã¯å…¥åŠ›å€¤ã¨ã—ã¦ä½¿ç”¨ã§ããªã„');
  }
  return x + y;
}
```

å®Ÿéš›ã«åˆ©ç”¨å´ã‹ã‚‰`add`é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ã¿ãŸä¾‹ãŒä¸‹è¨˜ã§ã™ã€‚

```ts
import { add } from "./sample";
try {
  add(1, 2);
} catch {
  alert("è¨ˆç®—ã§ããªã„æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã¦ã„ã¾ã™");
}
```

ã“ã®ã‚ˆã†ã«å…¥åŠ›ãŒé™çš„ã«æ±ºã¾ã£ã¦ã„ã‚‹å ´åˆã¯ãã‚‚ãã‚‚ä¾‹å¤–ãŒç™ºç”Ÿã—ãªã„ã“ã¨ã¯æ˜ã‚‰ã‹ã§ã™ãŒã€å®Ÿå‹™ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚ˆã‚Šè¤‡é›‘ã«ãªã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚
ä¾‹ã¨ã—ã¦`add`é–¢æ•°ã®å¼•æ•°ãŒé…åˆ—ã®ç‰¹å®šã®ä½ç½®ã‚’æŠœãå‡ºã™ã¨ã„ã†ã‚³ãƒ¼ãƒ‰ã®å ´åˆ[`RangeError`](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/RangeError)ãŒç™ºç”Ÿã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/RangeError

```ts
import { add } from "./sample";
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›å€¤ã‚’é…åˆ—ã«æ ¼ç´ã—ã¦ãŠãå¤‰æ•°
const userInput: number[] = foo;
try {
  add(userInput[0], userInput[1]);
  // userInput.length = 1 ã®å ´åˆãªã©ã« RangeError ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§
} catch {
  alert("è¨ˆç®—ã§ããªã„æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã¦ã„ã¾ã™");
  // å®Ÿéš›ã«ã¯å…¥åŠ›å€¤ãŒä¸è¶³ã—ã¦ã„ã‚‹ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã™ã¹ã¦ã®ã‚¨ãƒ©ãƒ¼ã‚’catchã—ã¦ã—ã¾ã†
}
```

ã“ã®ã‚ˆã†ã«`try...catch`ã§ã¯å…¨ã¦ã®ã‚¨ãƒ©ãƒ¼ã‚’å—ã‘å–ã£ã¦ã—ã¾ã†ãŸã‚ã€æ„å›³ã—ãªã„ã‚¨ãƒ©ãƒ¼ã‚‚å—ã‘å–ã£ã¦`catch`ç¯€ãŒå®Ÿè¡Œã•ã‚Œã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ä¾‹å¤–ã‚’æŠ•ã’ãšã«`Error`ã¨ã®`Union`å‹ã‚’è¿”å´ã™ã‚‹å ´åˆã‚‚ã“ã®ç‚¹ã«ã¯æ³¨æ„ãŒå¿…è¦ã§ã€`JavaScript`ã®å„ç¨®ã‚¨ãƒ©ãƒ¼ã¯`Error`ã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ãŸã‚`RangeError instanceof Error`ã¯`true`ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚

```ts
import { add } from "./sample";

const userInput: number[] = foo;
const result: number | Error = add(userInput[0], userInput[1]);

if (result instanceof Error) {
  // RangeError ã‚‚ instanceof Errorã‚’æº€ãŸã—ã¦ã—ã¾ã†
  alert("è¨ˆç®—ã§ããªã„å€¤ãŒå«ã¾ã‚Œã¦ã„ã¾ã™")
};
```

ã“ã‚Œã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã¯è¿”å´ã™ã‚‹ã‚¨ãƒ©ãƒ¼ã‚’ç‹¬è‡ªã‚¨ãƒ©ãƒ¼ã«å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```ts:sample.ts
// è¨ˆç®—ä¸èƒ½ã‚’è¡¨ã™ã‚¨ãƒ©ãƒ¼
export class IncomputableError extends Error {
  constructor() {
    super();
  }
}

export const add = (x: number, y: number): number | IncomputableError => {
  if (Number.isNaN(x) || Number.isNaN(y)) {
    return new IncomputableError('NaNã¯å…¥åŠ›å€¤ã¨ã—ã¦ä½¿ç”¨ã§ããªã„');
  }
  return x + y;
}
```

```ts
import { add, IncomputableError } from "./sample";

const userInput: number[] = foo;
const result: number | IncomputableError = add(userInput[0], userInput[1]);

if (result instanceof IncomputableError) {
  alert("è¨ˆç®—ã§ããªã„å€¤ãŒå«ã¾ã‚Œã¦ã„ã¾ã™")
};
```

ã“ã®æ‰‹æ³•ã®å ´åˆãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ã‚‚æœ‰åŠ¹ãªãƒã‚§ãƒƒã‚¯ãŒã§ãã‚‹ä¸€æ–¹ã§ã€å†—é•·ãªæ›¸ãæ–¹ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚
ãã®ãŸã‚`TypeScript`ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã‚¿ã‚°ä»˜ããƒ¦ãƒ‹ã‚ªãƒ³ã‚’åˆ©ç”¨ã—ãŸResultå‹ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã‚ˆã‚Šã‚¹ãƒãƒ¼ãƒˆãªæ›¸ãæ–¹ãŒã§ãã¾ã™ã€‚

### Resultå‹ã§è¡¨ç¾ã™ã‚‹

`Result`å‹ã¨ã¯ã€
