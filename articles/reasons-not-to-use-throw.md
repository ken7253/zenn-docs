---
title: "ç§ãŒthrowã‚’ä½¿ã‚ãªã„ç†ç”±"
emoji: "ğŸ˜Š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['javascript','typescript']
published: false
---

## ç§ãŒthrowã‚’ä½¿ã‚ãªã„ç†ç”±

JavaScriptã§ã¯`throw`æ–‡ã¨ã„ã†æ–‡ã‚’ä½¿ã†ã“ã¨ã§ä¾‹å¤–ã‚’æŠ•ã’ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://jsprimer.net/basic/error-try-catch/#throw

https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/throw

ã“ã®`throw`æ–‡ã§ã™ãŒã€ç§ã¯ã‚ˆããƒ¬ãƒ“ãƒ¥ãƒ¼ãªã©ã§ä¾‹å¤–ã‚’æŠ•ã’ãªã„ã§ãã ã•ã„ï¼ˆ`throw`æ–‡ã‚’ä½¿ã‚ãªã„ã§ã»ã—ã„ï¼‰ã¨ã„ã†ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã™ã‚‹ã®ã§ã™ãŒãã®ç†ç”±ã¨ã©ã®ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚Œã°ã‚ˆã„ã®ã‹ã€ã¨ã„ã†ã“ã¨ã‚’æ›¸ã„ã¦ãŠã“ã†ã¨æ€ã„ã¾ã—ãŸã€‚

### å‰ææ¡ä»¶

ã“ã®è¨˜äº‹ã®å†…å®¹ã¯ä¸‹è¨˜ã®æ¡ä»¶ã‚’å‰æã¨ã—ã¦æ›¸ãé€²ã‚ã¦ã„ãã¾ã™ã€‚

- `TypeScript`ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ã“ã¨
- Webãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã«`JavaScript`ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆ

Node.jsã‚’åˆ©ç”¨ã—ãŸã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã‚„CLIãƒ„ãƒ¼ãƒ«ã®é–‹ç™ºã€å„ç¨®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é–‹ç™ºã«ã¤ã„ã¦ã¯æœ¬è¨˜äº‹ã®å¯¾è±¡ã«å«ã¾ã‚Œãªã„ã“ã¨ã‚’ã”äº†æ‰¿ä¸‹ã•ã„ã€‚

### çµè«–

å…ˆã«çµè«–ã‹ã‚‰æ›¸ã„ã¦ãŠãã¨TypeScriptã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆä¾‹å¤–ã¯ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã™ã‚‹ã‹ã€Resultå‹ã‚’åˆ©ç”¨ã™ã‚‹ã®ãŒã‚ˆã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚
æ¬¡ã®ç« ã‹ã‚‰ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ç”¨ã„ãªãŒã‚‰`throw`æ–‡ã‚’ä½¿ã£ãŸå®Ÿä¾‹ã¨ã€ä»£æ›¿ãˆæ¡ˆã«ã¤ã„ã¦è¨˜è¿°ã—ã¦ã„ãã¾ã™ã€‚

### ãªã«ã‚’å•é¡Œã ã¨æ„Ÿã˜ã¦ã„ã‚‹ã®ã‹

`throw`æ–‡ã‚’åˆ©ç”¨ã—ãŸå ´åˆã®ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã¨ã—ã¦å€‹äººçš„ã«æ„Ÿã˜ã¦ã„ã‚‹è¦³ç‚¹ã¯ä¸‹è¨˜ã®ï¼’ã¤ã§ã™ã€‚

- `try...catch`ã‚’ä½¿ã†ã¹ãé–¢æ•°ãªã®ã‹ã¨ã„ã†æƒ…å ±ãŒå¤–éƒ¨ã‹ã‚‰åˆ†ã‹ã‚‰ãªã„
- æƒ³å®šã—ã¦ã„ãªã„`Error`ã‚’å—ã‘å–ã£ã¦ã—ã¾ã†å ´åˆãŒã‚ã‚‹

ä¸‹è¨˜ã®`x`ã¨`y`ã‚’å…¥åŠ›ã—ã¦ãã®åˆè¨ˆå€¤ã‚’è¿”ã™`add`é–¢æ•°ã‚’ä¾‹ã¨ã—ã¦è€ƒãˆã¦ã„ãã¾ã™ã€‚

```ts:add.ts
export const add = (x: number, y: number): number => {
  return x + y;
}
```

ã“ã®é–¢æ•°ã«`x`ã‹`y`ã©ã¡ã‚‰ã‹ãŒ`NaN`ã®å ´åˆä¾‹å¤–ã‚’æŠ•ã’ã‚‹ã¨ã„ã†ä½¿ç”¨ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```diff ts:add.ts
 export const add = (x: number, y: number): number => {
+  if (Number.isNaN(x) || Number.isNaN(y)) {
+    throw new Error('NaNã¯å…¥åŠ›å€¤ã¨ã—ã¦ä½¿ç”¨ã§ããªã„');
+  }
   return x + y;
 }
```

ã“ã‚Œã§ã“ã®é–¢æ•°ã¯ç‰¹å®šã®æ¡ä»¶ã§ä¾‹å¤–ã‚’æŠ•ã’ã‚‹é–¢æ•°ã¨ãªã‚Šã¾ã—ãŸã€‚

ã¾ãšã¯ã€Œ`try...catch`ã‚’ä½¿ã†ã¹ãé–¢æ•°ãªã®ã‹ã¨ã„ã†æƒ…å ±ãŒå¤–éƒ¨ã‹ã‚‰åˆ†ã‹ã‚‰ãªã„ã€ã¨ã„ã†éƒ¨åˆ†ã§ã™ãŒ  
ã“ã®é–¢æ•°ã‚’ä»–ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰`import`ã—ã¦åˆ©ç”¨ã™ã‚‹å ´åˆå‹å®šç¾©ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts:add.d.ts
export declare const add: (x: number, y: number) => number;
```

ã“ã®çŠ¶æ…‹ã§ã¯å¤–éƒ¨ã‹ã‚‰åˆ©ç”¨ã™ã‚‹éš›ã«å¤±æ•—ã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹é–¢æ•°ï¼ˆ`try...catch`ã‚’åˆ©ç”¨ã™ã‚‹ã¹ãé–¢æ•°ï¼‰ã§ã‚ã‚‹ã“ã¨ãŒã‚³ãƒ¼ãƒ‰å†…éƒ¨ã‚’ç¢ºèªã™ã¾ã§åˆ†ã‹ã‚‰ãªã„çŠ¶æ…‹ã¨ãªã‚Šã¾ã™ã€‚

### Errorã¨ã®Unionå‹ã§è¡¨ç¾ã™ã‚‹

ä¸€ç•ªã¨ã£ã¤ãã‚„ã™ã„å¤‰æ›´ã¨ã—ã¦ã¯å¾“æ¥`throw new Error()`ã¨ã—ã¦ã„ãŸç®‡æ‰€ã‚’`return new Error()`ã«æ›¸ãæ›ãˆã‚‹æ‰‹æ³•ã ã¨æ€ã„ã¾ã™ã€‚
ã“ã‚Œã¾ã§ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã«é©ç”¨ã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```diff ts:add.ts
-export const add = (x: number, y: number): number => {
+export const add = (x: number, y: number): number | Error => {
   if (Number.isNaN(x) || Number.isNaN(y)) {
-    throw new Error('NaNã¯å…¥åŠ›å€¤ã¨ã—ã¦ä½¿ç”¨ã§ããªã„');
+    return new Error('NaNã¯å…¥åŠ›å€¤ã¨ã—ã¦ä½¿ç”¨ã§ããªã„');
   }
   return x + y;
 }
```

å¤‰æ›´ã‚’åŠ ãˆã‚‹ã“ã¨ã«ã‚ˆã‚Šé–¢æ•°ã®è¿”ã‚Šå€¤ã®å‹ãŒ`number`ã‹ã‚‰`number|Error`ã«å¤‰åŒ–ã—ã¾ã—ãŸã€‚
ã“ã®ã‚ˆã†ã«ä¾‹å¤–ã‚’æŠ•ã’ã‚‹ã®ã§ã¯ãªãã€ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šåˆ©ç”¨å´ã§ã¯`Error`å‹ãŒå«ã¾ã‚Œã‚‹ãŸã‚å¤±æ•—ã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹é–¢æ•°ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

### æƒ³å®šã—ã¦ã„ãªã„`Error`ã‚’å—ã‘å–ã£ã¦ã—ã¾ã†å ´åˆãŒã‚ã‚‹

æ¬¡ã«ã€Œæƒ³å®šã—ã¦ã„ãªã„`Error`ã‚’å—ã‘å–ã£ã¦ã—ã¾ã†å ´åˆãŒã‚ã‚‹ã€ã¨ã„ã†å•é¡Œã§ã™ãŒã€ã¾ãšã¯æœ€åˆã®`throw`ã‚’ä½¿ã£ãŸå®Ÿè£…ã‹ã‚‰ç¢ºèªã—ã¦ã„ãã¾ã™ã€‚

```ts:add.ts
export const add = (x: number, y: number): number => {
  if (Number.isNaN(x) || Number.isNaN(y)) {
    throw new Error('NaNã¯å…¥åŠ›å€¤ã¨ã—ã¦ä½¿ç”¨ã§ããªã„');
  }
  return x + y;
}
```

é–¢æ•°ã®å¼•æ•°ã«`1`ã‚„`50`ãªã©ç›´æ¥æ•°å€¤ã‚’å…¥ã‚Œã‚‹å ´åˆã¯å•é¡Œã‚ã‚Šã¾ã›ã‚“ãŒã€ã“ã®é–¢æ•°ã®å¼•æ•°ã«åˆ¥ã®é–¢æ•°ã®æˆ»ã‚Šå€¤ã‚’å…¥ã‚Œã‚‹å ´åˆã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚

```ts
// å¸¸ã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹fooé–¢æ•°
const foo = () => {
  throw new Error("Foo Error");
}

try {
  add(foo(), 10);
} catch {
  // è¶³ã—ç®—ã«å¤±æ•—ã—ãŸã¨ã„ã†å‰æã§catchç¯€ãŒå®Ÿè¡Œã•ã‚Œã¦ã—ã¾ã†
  alert("è¶³ã—ç®—ãŒã§ãã¾ã›ã‚“ã§ã—ãŸ");
}
```

ã“ã“ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹é–¢æ•°`foo`ã¯å¸¸ã«ã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹é–¢æ•°ã§ã™ãŒã€å˜ç´”ãª`try...catch`ã§ã¯`foo()`ã¨`add()`ã©ã¡ã‚‰ã®å‡¦ç†ãŒå¤±æ•—ã—ãŸã®ã‹ã«ã‹ã‹ã‚ã‚‰ãš`catch`ç¯€ãŒå®Ÿè¡Œã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚

#### ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ã‚’åˆ¤å®šã—ã¦å‡ºã—åˆ†ã‘ã‚’è¡Œã†å ´åˆ

ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ã‚’åˆ¤åˆ¥ã—ã¦ã€å‡¦ç†ã‚’åˆ†ã‘ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ãŒå†—é•·ã§ã‚ã£ãŸã‚Šä¸å®‰å®šãªã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã—ã¾ã†ã®ã§çœç•¥ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚

:::details `error.message`ã®æ¯”è¼ƒã‚’è¡Œã†æ–¹æ³•

`error.message`ã‚’å‚ç…§ã—ã¦ã‚¨ãƒ©ãƒ¼æ–‡ã‚’åŸºæº–ã«å‡¦ç†ã‚’åˆ†ã‘ã‚‹ã“ã¨ã¯å¯èƒ½ã§ã™ã€‚
ã—ã‹ã—ã€ã‚¨ãƒ©ãƒ¼æ–‡ã‚’å¤‰æ›´ã—ãŸã ã‘ã§å£Šã‚Œã‚‹ã®ã§ã‚ã¾ã‚Šç¾å®Ÿçš„ã§ã¯ãªã„ã¨æ€ã„ã¾ã™ã€‚

```ts
// å¸¸ã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹fooé–¢æ•°
const foo = () => {
  throw new Error("Foo Error");
}

try {
  add(foo(), 10);
} catch (error) {
  if (error.message === "Foo Error") {
    // foo()ã‚’å‘¼ã³å‡ºã—ãŸã“ã¨ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
  } else if (error.message === 'NaNã¯å…¥åŠ›å€¤ã¨ã—ã¦ä½¿ç”¨ã§ããªã„') {
    // å…¥åŠ›å€¤ã«NaNãŒå«ã¾ã‚Œã¦ã„ãŸå ´åˆ
  }
}
```

:::

:::details ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ã‚’å®šç¾©ã™ã‚‹

`Error`ã‚’ç¶™æ‰¿ã—ãŸç‹¬è‡ªã‚¨ãƒ©ãƒ¼ã‚’å®šç¾©å¾Œãã‚Œãã‚Œã®é–¢æ•°ã§ãã‚Œãã‚Œç‹¬è‡ªã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹ã‚ˆã†ã«ã€
`instanceof`æ¼”ç®—å­ã‚’åˆ©ç”¨ã—ã¦ã©ã®ç‹¬è‡ªã‚¨ãƒ©ãƒ¼ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒ`error`ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã®ã‹ã§åˆ¤æ–­ã™ã‚‹æ–¹æ³•ã‚‚å­˜åœ¨ã—ã¾ã™ãŒã€ã‹ãªã‚Šå†—é•·ã«ãªã‚‹ã®ã§ã“ã¡ã‚‰ã‚‚ç¾å®Ÿçš„ã§ã¯ãªã„ã¨æ€ã„ã¾ã™ã€‚

```ts:customError.ts
// é–¢æ•°fooå°‚ç”¨ã®ã‚¨ãƒ©ãƒ¼
class FooError extends Error {
  constructor(message) {
    super(message);
  }
}

// è¨ˆç®—ä¸å¯ã‚¨ãƒ©ãƒ¼
class IncomputableError extends Error {
  constructor(message) {
    super(message);
  }
}
```

```ts
const foo = () => {
  throw new FooError("Foo Error");
}

try {
  add(foo(), 10);
} catch (error) {
  // error ãŒã©ã®ç‹¬è‡ªã‚¨ãƒ©ãƒ¼ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚ã‚‹ã‹ã‚’åŸºæº–ã«åˆ¤å®š
  if (error instanceof FooError) {
    // foo()ã‚’å‘¼ã³å‡ºã—ãŸã“ã¨ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
  } else if (error instanceof IncomputableError) {
    // å…¥åŠ›å€¤ã«NaNãŒå«ã¾ã‚Œã¦ã„ãŸå ´åˆ
  }
}
```

:::

### Resultå‹ã§è¡¨ç¾ã™ã‚‹

Resultå‹ã¯å‡¦ç†ã®æˆåŠŸãƒ»å¤±æ•—ã‚’å‹ã¨ã—ã¦è¡¨ç¾ã™ã‚‹æ–¹æ³•ã§ã™ã€‚
Rustã‚„Swiftãªã©ã§ã¯å…ƒã‹ã‚‰æä¾›ã•ã‚Œã¦ã„ã‚‹æ©Ÿèƒ½ã§ã™ãŒã€TypeScriptã«ã¯å­˜åœ¨ã—ãªã„ãŸã‚ã‚¯ãƒ©ã‚¹ã‚„[ã‚¿ã‚°ä»˜ããƒ¦ãƒ‹ã‚ªãƒ³](https://typescriptbook.jp/reference/values-types-variables/discriminated-union)ã‚’åˆ©ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ã®å‹ã¨ã—ã¦è¡¨ç¾ã•ã‚Œã¾ã™ã€‚

https://typescriptbook.jp/reference/values-types-variables/discriminated-union

[TypeScript 4.6ä»¥é™ã¯ã‚¿ã‚°ä»˜ããƒ¦ãƒ‹ã‚ªãƒ³ã®ä½¿ã„å‹æ‰‹ãŒæ ¼æ®µã«è‰¯ããªã£ã¦ã„ã‚‹](https://zenn.dev/uhyo/articles/ts-4-6-destructing-unions)ãŸã‚å€‹äººçš„ã«ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«å‹å®šç¾©ã®ã¿ã§ã‚‚ååˆ†ã ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

https://zenn.dev/uhyo/articles/ts-4-6-destructing-unions

```ts:Result.ts
// æˆåŠŸæ™‚ã®å‹å®šç¾©
type SuccessResult<T> = {
  type: 'success';
  payload: T;
}
// å¤±æ•—æ™‚ã®å‹å®šç¾©
type ErrorResult = {
  type: 'error';
  error: Error;
}

export type Result<T = unknown> = SuccessResult<T> | ErrorResult;
```

ãã—ã¦ä»Šã¾ã§ã®ã‚³ãƒ¼ãƒ‰ã‚’ä¸Šè¨˜ã®å‹å®šç¾©ã‚’åˆ©ç”¨ã—ãŸã‚³ãƒ¼ãƒ‰ã¨ã—ã¦æ›¸ãç›´ã™ã¨ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts:add.ts
import type { Result } from './Result.ts';
export const add = (x: number, y: number): Result<number> => {
  if (Number.isNaN(x) || Number.isNaN(y)) {
    return {
      type: 'error',
      error: new Error('NaNã¯å…¥åŠ›å€¤ã¨ã—ã¦ä½¿ç”¨ã§ããªã„');
    }
  }
  return {
    type: 'success',
    payload: x + y;
  }
}
```

```ts
const result = add(2, 10);

if (result.type === 'error') {
  // ErrorResultå‹ã¨ã—ã¦æ¨è«–
  console.error(result.error.message);
} else {
  // SuccessResultå‹ã¨ã—ã¦æ¨è«–
  console.log(result.payload);
}
```

ã¾ãŸã€é–¢æ•°`foo`ã«ã¤ã„ã¦ã‚‚`throw`ã‚’ä½¿ã‚ãªããªã‚‹ã“ã¨ã§æ›¸ãæ–¹ãŒå¤‰ã‚ã‚Šå®‰å…¨ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
é–¢æ•°`foo`ã«é–¢ã—ã¦ã¯å¸¸ã«`error`ã‚’è¿”ã™ã®ã§è‹¥å¹²ã‚ã‹ã‚Šã¥ã‚‰ããªã£ã¦ã—ã¾ã„ã¾ã—ãŸãŒã€æœ€åˆã«æŒ™ã’ã¦ã„ãŸ

- `try...catch`ã‚’ä½¿ã†ã¹ãé–¢æ•°ãªã®ã‹ã¨ã„ã†æƒ…å ±ãŒå¤–éƒ¨ã‹ã‚‰åˆ†ã‹ã‚‰ãªã„
- æƒ³å®šã—ã¦ã„ãªã„`Error`ã‚’å—ã‘å–ã£ã¦ã—ã¾ã†å ´åˆãŒã‚ã‚‹

ã¨ã„ã†å•é¡Œã‚’è§£æ±ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```ts
const foo = (): Result => {
  return {
    type: 'error',
    error: new Error("Foo Error")
  }
}
const fooResult = foo();
if (fooResult.type === 'success') {
  // type: 'success' ã‚’è¿”ã™ã“ã¨ãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„ã®ã§å®Ÿè¡Œã•ã‚Œãªã„
  const result = add(fooResult.payload, 10);

  if (result.type === 'error') {
    // ErrorResultå‹ã¨ã—ã¦æ¨è«–
    console.error(result.error.message);
  } else {
    // SuccessResultå‹ã¨ã—ã¦æ¨è«–
    console.log(result.payload);
  }
}
```
